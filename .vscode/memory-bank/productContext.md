# Product Context - なぜこのプロジェクトが存在するか# Product Context: Memory MCP



## 問題空間## なぜこのプロジェクトが存在するか



### 解決する問題### 問題解決

1. **セッション限定の記憶**: 従来のAIは会話が終わると記憶を失う- **記憶の断絶**: AIアシスタントは会話セッションごとに完全にリセットされるため、継続的な文脈を保持できない

2. **文脈理解の限界**: 単純なキーワード検索では意味的関連性を捉えられない- **文脈の喪失**: ユーザーの好み、過去のやり取り、技術的な成果が活用できない

3. **Persona管理の難しさ**: 複数のAI人格を同一システムで管理できない- **検索の限界**: キーワード検索では意味的に関連する記憶を見つけにくい

4. **感情コンテキストの欠如**: 感情や関係性の変化を記録・追跡できない- **Persona管理の複雑さ**: 複数のAIペルソナの記憶を分離して管理するのが困難

5. **記憶の整理**: 時間経過とともに重複・矛盾する記憶が増加- **記憶の可視化不足**: 記憶や関係性・感情の変化を直感的に把握できない

6. **スケーラビリティ**: ローカルFAISSだけでは大規模記憶管理が困難- **記憶の整理負担**: 重複や古い記憶の整理・統合が手作業で煩雑



### ユーザーペインポイント### 解決策

- 「前に話したことを覚えていてほしい」- **永続的なメモリシステム**: 

- 「似た話題を自動的に関連付けてほしい」  - SQLite (memory/{persona}/memory.sqlite) で記憶を永続化

- 「異なるキャラクター設定ごとにデータを分けたい」  - JSONL (memory_operations.log) で操作履歴を記録

- 「感情や関係性の変化を追跡したい」  - FAISS (vector_store/) で意味検索を可能に

- 「古い記憶を自動的に整理してほしい」  - 自動データベースマイグレーション

- 「クラウド環境でもスケールする仕組みが欲しい」  

- **RAG (Retrieval-Augmented Generation)**:

## ソリューション  - HuggingFace Embeddings (cl-nagoya/ruri-v3-30m) で記憶をベクトル化

  - FAISS で高速な類似性検索

### コア機能  - CrossEncoder Reranking (hotchpotch/japanese-reranker-xsmall-v2) で精度向上

1. **永続メモリ**: SQLite + FAISS/Qdrantでセッション横断記憶  

2. **意味検索**: HuggingFace埋め込み + CrossEncoderリランキング- **MCPサーバー**: 

3. **Personaシステム**: X-Personaヘッダーで人格切り替え（完全分離）  - FastMCP で標準化されたプロトコル実装

4. **コンテキスト管理**: 感情・体調・環境・関係性の統合記録  - VS Code Copilot から直接アクセス可能

5. **自動整理**: アイドル時の重複検知・知識グラフ生成  - ツール: create, read, update, delete, list, search, search_rag, search_by_date, search_by_tags, clean, get_persona_context, get_time_since_last_conversation

6. **可視化**: Webダッシュボードで記憶の全体像を把握  

7. **マルチバックエンド**: FAISS（ローカル）とQdrant（スケーラブル）の両対応- **Personaサポート**:

  - FastMCP依存関数 (get_http_request) によるX-Personaヘッダー取得

### ユニークバリュー  - Persona別のSQLiteデータベースとベクトルストア

- **日本語特化**: 日本語RAGに最適化されたモデル選択  - ミドルウェア不要のシンプル実装

  - 埋め込み: `cl-nagoya/ruri-v3-30m` (軽量・高精度)  

  - リランカー: `hotchpotch/japanese-reranker-xsmall-v2`- **タグ管理**:

- **感情的知性**: 感情分析を記憶システムに統合  - 柔軟なタグ付けシステム

- **柔軟なバックエンド**:   - 定義済みタグ: important_event, relationship_update, daily_memory, technical_achievement, emotional_moment

  - FAISS（ローカル、高速、シンプル）  - タグベースの検索機能

  - Qdrant（スケーラブル、クラウド対応、フィルタリング強力）  

  - 双方向移行ツール（FAISS ↔ Qdrant）- **コンテキスト追跡**:

- **クリーンアーキテクチャ**: Phase 1で90.6%のコード削減達成  - 感情状態（emotion_type）

- **軽量Docker**: 2.65GBの最適化イメージ（68.0%削減）  - 体調状態（physical_state）

- **動的Personaサポート**: リクエストごとにペルソナ別ベクトルストア動的生成  - 心理状態（mental_state）

  - 環境（environment）

## 市場とユーザー  - 関係性（relationship_status）

  - 最終会話時刻（last_conversation_time）

### ターゲットユーザー  

1. **AI開発者**: 対話システムに永続記憶を追加したい- **知識グラフ化**: 

2. **研究者**: RAG/感情分析の実験プラットフォームが必要  - `[[]]` 形式で人名・技術・概念をリンク

3. **個人利用者**: カスタムAIアシスタントを構築したい  - Obsidian での可視化に対応

4. **企業開発者**: 顧客対話履歴を管理したい

- **AIアシスト・自動整理**:

### ユースケース  - 感情分析・重複検出・自動整理・要約などのAI機能で記憶を賢く管理

- **個人アシスタント**: 長期的な関係性を持つAI  - アイドル時に自動で重複整理を提案

- **カスタマーサポート**: 顧客ごとの履歴管理- **Webダッシュボード・可視化**:

- **研究ノート**: 研究過程の記憶・検索  - モダンなWeb UIで記憶・統計・知識グラフを可視化

- **キャラクターAI**: ゲーム/VTuberのキャラクター記憶  - API連携で外部ツールや拡張も容易

- **企業知識ベース**: チーム/プロジェクトごとの記憶管理

### 価値提供

## 競合と差別化- **関係性の継続**: セッションをまたいで文脈を保持

- **高度な検索**: 自然言語で記憶を探せる（RAG + Reranking）

### 既存ソリューション- **柔軟な分類**: タグによる効率的な記憶管理

- **LangChain Memory**: 基本的なメモリ機能のみ、Personaサポートなし- **時間認識**: 経過時間を意識した応答

- **Pinecone/Weaviate**: ベクトルDBのみ、感情・Personaサポートなし- **ポータビリティ**: Dockerで簡単にデプロイ可能

- **カスタムソリューション**: 再利用性低い、保守困難- **AIアシストによる体験向上**: 感情や重複を自動で整理、記憶の質を高める

- **可視化・直感的な操作**: Webダッシュボードで記憶・統計・知識グラフを一目で把握

### 差別化ポイント- **拡張性**: APIやWeb UIで新しい体験や連携が可能

- ✅ **MCP準拠**（標準プロトコル）

- ✅ **Personaごとの完全分離**（X-Personaヘッダー + 動的切替）## ターゲットユーザー

- ✅ **感情・コンテキスト統合**- **AI開発者**: MCPプロトコルを使用したメモリ管理を実装したい

- ✅ **自動整理・知識グラフ生成**- **AIユーザー**: AIとの継続的な会話履歴を保持したい

- ✅ **日本語最適化**- **Use Case**: 

- ✅ **ダッシュボードUI**  - AIアシスタントに永続的な記憶を持たせたい

- ✅ **クリーンアーキテクチャ**  - 複数のペルソナを独立して管理したい

- ✅ **マルチバックエンド** + 双方向移行ツール  - 技術的な議論の履歴を保存したい

- ✅ **Docker最適化済み**（2.65GB）  - 自然言語による意味的な記憶検索を実現したい



## プロダクトビジョン## 成功指標

- ✅ セッション開始時に過去の会話・関係性を正確に思い出せる

### 短期目標（Phase 25-27）- ✅ Rerankingで最も関連性の高い記憶を優先表示できる

- API拡張とテスト強化- ✅ データの永続性と信頼性（JSON + FAISS + JSONL）

- パフォーマンス最適化（検索速度、メモリ使用量）- ✅ AIアシストで感情や重複を自動で整理できる

- ドキュメント完全化- ✅ Webダッシュボードで記憶や統計・知識グラフを直感的に見られる

- コミュニティフィードバック収集- ✅ 体験・可視化・拡張性の全てで「記憶の価値」を最大化できる

### 中期目標（6ヶ月）
- 多言語サポート（英語、中国語等）
- クラウドバックエンド統合拡張（Supabase、Pinecone等）
- プラグインシステム
- 高度な知識グラフ分析（時系列推移、感情マッピング）

### 長期ビジョン（1年）
- エンタープライズ対応（権限管理、監査ログ）
- マルチモーダル記憶（画像、音声、動画）
- フェデレーテッド記憶（分散Persona間の協調）
- AIエージェント間の記憶共有プロトコル
- リアルタイム協調記憶システム

## 成功指標

### 技術指標
- 検索精度（Recall@10 > 90%）
- レスポンス速度（< 100ms）
- メモリ使用量（< 512MB）
- Docker起動時間（< 30秒）
- イメージサイズ（< 3GB） ✅ 達成（2.65GB）

### ユーザー指標
- GitHub Stars（目標: 100）
- コントリビューター数（目標: 5）
- Issue解決率（> 80%）
- ドキュメント満足度（> 4.0/5）
- 本番デプロイ数（目標: 10+）

## 最近の成果（Phase 24）
- ✅ **動的Personaサポート実装**: グローバルvector_store問題を解決
- ✅ **リクエスト時動的切替**: ペルソナ別QdrantVectorStoreAdapter動的生成
- ✅ **検証完了**: memory_nilouコレクション 89→90ポイント（書き込み成功）
- ✅ **本番環境対応**: 84 memories → http://nas:6333 移行完了
