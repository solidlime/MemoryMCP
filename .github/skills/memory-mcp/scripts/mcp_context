#!/usr/bin/env python3
"""
MCP Context - Current context retrieval

Usage:
    mcp_context [options]

Examples:
    # デフォルトペルソナのコンテキストを取得
    mcp_context

    # 別のペルソナ
    mcp_context --persona alice

    # JSON出力
    mcp_context --format json
"""

import argparse
import sys
from mcp_common import load_config, call_mcp_tool, format_output, get_config_defaults


def main():
    parser = argparse.ArgumentParser(
        description="Get current context (promises, goals, favorites, preferences, anniversaries, etc.)"
    )

    parser.add_argument(
        "--persona",
        help="Persona name (default: from config)"
    )
    parser.add_argument(
        "--url",
        help="MCP server URL (default: from config)"
    )
    parser.add_argument(
        "--format",
        choices=["text", "json"],
        default="text",
        help="Output format"
    )

    args = parser.parse_args()

    # 設定読み込み
    config = load_config()
    default_persona, default_url = get_config_defaults(config)

    persona = args.persona or default_persona
    server_url = args.url or default_url

    # get_context呼び出し
    params = {}
    result = call_mcp_tool("get_context", params, persona, server_url)

    # 出力
    output = format_output(result, args.format)
    print(output)

    # エラーの場合は終了コード1
    if "error" in result:
        sys.exit(1)


if __name__ == "__main__":
    main()
